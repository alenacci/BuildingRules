{% extends "layout.html" %}
{% block body %}

  {% if session.logged_in %}

	<script type="text/javascript" src="{{ url_for('static', filename='js/rooms.js') }}"></script>
	<script>
	window.onload = function(){
	init();
	{% if alreadyLoggedIn %}
	{% else %}
	document.getElementById('showGuideButton').click();
	{% endif %}
	};
	</script>

	<script type="text/javascript">
	var popupStyle = "top=10, left=10, width=350, height=250, status=no, menubar=no, toolbar=no, scrollbars=yes";
	
	function openPopup(url) 
	{
		window.open(url, "", popupStyle);
	}
	</script>


	<!-- Modal -->
	<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 700px; margin-left: -350px;">
	  <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
	    <h3 id="myModalLabel">User Guide</h3>
	  </div>
	  <div class="modal-body" align="center">
	    <iframe width="670" height="410" src="//www.youtube.com/embed/hqoghKelQ6E?rel=0&vq=hd720" frameborder="0" allowfullscreen></iframe>
	  </div>
	  <div class="modal-body">
		We are conducting an academic experiment to gauge the ease of use of a new technology to manage Smart Buildings. The technology is a web application that allows you to specify policies you would want in your office. You can set policies like turn on office lights when it is raining, or turn on cooling when temperature is 75F. The software makes sure that you don't conflict other employees in the office or the policies set by the building manager. 
	  </div>
	  <div class="modal-footer">
	    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
	  </div>
	</div>




	<div class="form-actions"> 
		<a class="btn btn-lg btn-success" href="javascript:hideMTurk()" id="btnHideMTurk">Hide this panel</a>
		<a class="btn btn-lg btn-success" href="javascript:showMTurk()" id="btnShowMTurk">Show mTurk Panel</a>
		<div id="mturkPanel">
			<h3 align="center">Amazon Mechanical Turk</h3>
			<h6 align="center">Experiment day: {{mTurkStatus.currentDay}}/7 - Current datetime: {{mTurkStatus.serverDatetime}} GMT-8</h6>

			{% if mTurkStatus.taskCompleted %}
				<div class="alert alert-success">
					<h5 align="center">Today task completed</h5>
					<h6 align="center">Please insert the following token into the Amazon mTurk form to get your money.</h6>
					<h6 align="center">{{mTurkStatus.token}}</h6>
				</div>
				<div class="alert alert-block" align="center">
					<strong>STORE THIS TOKEN RIGHT NOW!</strong> <br> Store this token somewhere on your computer before refreshing the page! 
				</div>
			{% else %}
				<div class="alert alert-block" align="center">
					<h5>Today task NOT completed</h5>
					<h6 align="center">{{mTurkStatus.message}}</h6>
				</div>
			{% endif %}

			{% if mTurkStatus.experimentCompleted %}
				<div class="alert alert-success">
					<h4 align="center">You completed the whole expriment!</h4	> 
					<h6 align="center">Now log into MTurk and copy and paste all the token you received in this week!</h6> 
				</div>
			{% endif %}

			<hr>

			<div align="center">
				<h5>Do you have any suggestion? Or do you want to give us a score? Use this form!</h5>
				<form class="form-inline" action="{{url_for('gui.sendFeedback')}}" method="POST">
					<input name="alternativeContact" class="span3" type="email"  class="input-small" placeholder="Your email (if you want)...">
					<input name="score" type="text" class="input-small" placeholder="Score [0/10]...">
					<input name="message" type="text" class="input-xxlarge" placeholder="Put here your feedback message...">
					<button type="submit" class="btn">Send feedback</button>
				</form>
			</div>
		</div>
	</div>

	<br>
	


	<header class="jumbotron subhead" id="overview">

	    <div class="span8">
	      <h1>My Rooms</h1>
	      <p class="lead">With this page you can create your own simple rules for your own personal spaces. Just add the rules inside the correct box and... that's all!</p>
	      <br>
	      <a href="#rulesPanel" role="button" class="btn btn-primary ">Go to the rules panel!</a>
	      <a href="#myModal" role="button" class="btn" data-toggle="modal" id="showGuideButton">Show the Video User Guide!</a>
	    </div>
	    <div class="span4">
	    </div>
	</header>

	<br>
	<br>
	<br>

	{% if roomList %}
		<section id="typography">

			 <a name="rulesPanel" id="rulesPanel"></a>

			<div class="form-actions">
				<a class="btn btn-lg btn-success" href="javascript:showMaps()" id="btnShowMaps">Show Map</a>
				<a class="btn btn-lg btn-success" href="javascript:hideMaps()" id="btnHideMaps">Hide Map</a>
				<a class="btn btn-lg btn-success" href="javascript:showThermalZoneMaps()" id="btnShowThMaps">Show Shared Actuation Zones Map</a>
				<a class="btn btn-lg btn-success" href="javascript:showAccessMaps()" id="btnShowAccMaps">Show Access Rights Map</a>
			  	<div id="accessMap">
			  		<img src="{{url_for('static', filename='roomMaps/')}}{{mapFileName}}">
			  		<br>
			  		<b>This maps shows the rooms you can access</b>
			  	</div>
			  	<div id="thZoneMap">
			  		<img src="{{url_for('static', filename='roomMaps/thermalZonesMap.png')}}">
			  		<br>
			  		<b>If your room has the same color of another room, you will share all the rules about the HEATING!</b>
			  	</div>
			 </div>


			

			<div class="form-actions">
				<form action="{{request.path}}" method="post">
					<h3>Filter rules by category: </h3>
					<small><b>NOTE:</b> IF NO FILTER IS SELECTED ALL THE RULES WILL BE SHOWN</small>
					<br>
					<br>
					{% for category in categories %}
						<label class="checkbox inline">
							<input type="checkbox" id="inlineCheckbox1" value="True" name="filter_by_{{category}}" {% if categoriesFilter %} {% if category in categoriesFilter %} checked {% endif %} {% endif %}> {{category}}
						</label>
					{% endfor %}
					<button type="submit" class="btn btn-primary btn-small">Filter now!</button>
					<br>
					

				</form>
			</div>

			{% for room in roomList %}
				<div class="row"> 
				  <div class="span8">
				    <h3>Room {{room.roomName}} - {{room.description}}</h3>
				    <hr>
				    {% for rule in roomRules[room.roomName] %}
				    	<blockquote {% if rule.id in activeRoomRules[room.roomName] %} style="color:#77AE3B;" {% endif %}>
				    		<p {% if rule.enabled %} {% else %} class="muted" {% endif %}>
				    			{% if rule.enabled %} {% else %} <strike> {% endif %}
				    				<b>if</b> {{rule.antecedent}} <b>then</b> {{rule.consequent}} 
				    			{% if rule.enabled %} {% else %} </strike> {% endif %}
								<small class="muted">
								<span class="badge">{{rule["priority"]}}</span>
									By:
									{% if session.userUuid == rule.authorUuid%}
										You
									{% else %}
										{{authorList[rule.authorUuid].personName}} - <i>{{authorList[rule.authorUuid].email}}</i>
									{% endif %}

									{% if rule.groupId %} 
										(Group {{rule.groupId }}-{{groupList[rule.groupId].description}}
										{% if rule.roomName %} 
											{% if rule.roomName == room.roomName %} {% else %} / Room {{rule.roomName}} {% endif %} 
										{% endif %}
										)
									{% endif %}

									{% if rule.groupId and rule.roomName %}
									- [<a href="{{request.path}}/../groups/{{rule.groupId}}/rooms/{{rule.roomName}}/rules/{{rule.id}}/edit">Edit</a>]
									  [<a href="{{request.path}}/{{rule.roomName}}/rules/{{rule.id}}/delete">Delete</a>]
									  
									{% else %}
										{% if rule.roomName %}
											- [<a href="{{request.path}}/{{rule.roomName}}/rules/{{rule.id}}/edit">Edit</a>] [<a href="{{request.path}}/{{rule.roomName}}/rules/{{rule.id}}/delete">Delete</a>]
											{% if rule.enabled %}
												[<a href="{{request.path}}/{{rule.roomName}}/rules/{{rule.id}}/disable">Disable</a>]
											{% else %}
												[<a href="{{request.path}}/{{rule.roomName}}/rules/{{rule.id}}/enable">Enable</a>]
											{% endif %}
										{% endif %}
									{% endif %}
								</small>
				    		</p>
				    	</blockquote> 
				    {% endfor %}

				    

				  </div>
				  <div class="span4">
				    <div class="well">
				      <h4>Sensors</h4>
				      <p>
				      	{% for trigger in triggerList[room.roomName] %}
				      		{{trigger.description}}, 
				      	{% endfor %}
				      </p>
				      <br>
				      <h4>Actuators</h4>
				      <p>
				      	{% for action in actionList[room.roomName] %}
				      		{{action.description}}, 
				      	{% endfor %}
				      </p>
				      <br>
				      <h4>Occupants:</h4>
				      <p>
				      	{% for user in userList[room.roomName] %}
				      		{{user.username}}, 
				      	{% endfor %}				      	
				      </p>
				      <br>
				      <h4>Part of groups: <br> <small>Click on the group name to see the room list</small></h4>

				      	{% for group in roomGroupList[room.roomName] %}
				      		<a href="javascript:openPopup('{{request.path}}/../groups/{{group.id}}');">{{group.id}}:{{group.description}}</a>, 
				      	{% endfor %}				      	
				    </div>
				  </div>
				</div>
				<br>
				<a href="{{request.path}}/{{room.roomName}}/rules/add"><button type="button" class="btn">Add a new rule</button></a>
				<br>
				<br>
		  	{% endfor %}
		</section>
	{% endif %}


  {% endif %}
{% endblock %}
